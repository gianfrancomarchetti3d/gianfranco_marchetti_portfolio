<!-- Three.js globale -->
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/controls/OrbitControls.js"></script>

<script>
  const wrap = document.getElementById('canvas-wrap');
  const width = wrap.clientWidth;
  const height = wrap.clientHeight;

  const scene = new THREE.Scene();
  scene.background = new THREE.Color(0x000000);

  const camera = new THREE.PerspectiveCamera(45, width/height, 0.1, 100);
  camera.position.set(6,5,8);

  const renderer = new THREE.WebGLRenderer({antialias:true, alpha:true});
  renderer.setSize(width,height);
  renderer.setPixelRatio(window.devicePixelRatio || 1);
  wrap.appendChild(renderer.domElement);

  const controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;
  controls.enablePan = false;
  controls.autoRotate = true;
  controls.autoRotateSpeed = 0.6;

  // Luci
  const dirLight = new THREE.DirectionalLight(0xffffff,0.9);
  dirLight.position.set(5,10,7);
  scene.add(dirLight);
  scene.add(new THREE.AmbientLight(0x7a7a7a,0.8));

  // Floor
  const floor = new THREE.Mesh(
    new THREE.PlaneGeometry(30,30),
    new THREE.MeshStandardMaterial({color:0x111111})
  );
  floor.rotation.x = -Math.PI/2;
  floor.position.y = -0.01;
  scene.add(floor);

  // Gears (stessa funzione createGear di prima)
  function createGear(radius, teeth, thickness, color){
    const group = new THREE.Group();
    const base = new THREE.CylinderGeometry(radius*0.86,radius*0.86,thickness,64);
    const mat = new THREE.MeshStandardMaterial({metalness:0.7,roughness:0.35,color:color});
    const baseMesh = new THREE.Mesh(base,mat);
    baseMesh.rotation.x = Math.PI/2;
    group.add(baseMesh);
    const toothGeom = new THREE.BoxGeometry(radius*0.15,thickness*1.05,radius*0.05);
    for(let i=0;i<teeth;i++){
      const t = new THREE.Mesh(toothGeom,mat);
      const angle = (i/teeth)*Math.PI*2;
      const r = radius*0.95;
      t.position.set(Math.cos(angle)*r,0,Math.sin(angle)*r);
      t.rotation.y = -angle;
      group.add(t);
    }
    return group;
  }

  const gear1 = createGear(1.5,28,0.4,0x4b5563);
  const gear2 = createGear(1.0,20,0.4,0x1f2937);
  const gear3 = createGear(0.6,14,0.4,0x374151);

  gear1.position.set(-1.0,0.28,0);
  gear2.position.set(0.8,0.28,0);
  gear3.position.set(2.0,0.28,0);

  scene.add(gear1,gear2,gear3);

  const clock = new THREE.Clock();
  function animate(){
    requestAnimationFrame(animate);
    const t = clock.getElapsedTime();
    gear1.rotation.z = t*0.6;
    gear2.rotation.z = -t*0.9;
    gear3.rotation.z = t*1.2;
    controls.update();
    renderer.render(scene,camera);
  }
  animate();

  window.addEventListener('resize',()=>{
    const w = wrap.clientWidth;
    const h = wrap.clientHeight;
    renderer.setSize(w,h);
    camera.aspect = w/h;
    camera.updateProjectionMatrix();
  });

  document.getElementById('year').textContent = new Date().getFullYear();
</script>
